{% load i18n %}
{% load staticfiles %}
{% load common_tags %}
{% load defer %}

 {% comment %} <div class="widget-box widget-color-green patientlist">
        <div class="widget-header">
            <h4 class="widget-title bigger lighter">
                <i class="ace-icon fa fa-users"></i>{% trans title %}
            </h4>
            
            {% if patientlists %}
                <div class="widget-toolbar no-border">
                    <div class="widget-menu visible-xs">
                        <a data-toggle="dropdown" data-action="settings" href="#" aria-expanded="false">
                        <i class="ace-icon fa fa-bars"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-right dropdown-light-blue dropdown-caret dropdown-closer">
                            {% for patientlist in patientlists %}
                            <li>
                                <a href="#{{patientlist.table_id}}" 
                                data-target="#{{patientlist.table_id}}, #{{patientlist.table_id}}_description"
                                data-toggle="tab">{{patientlist.title|safe}} <span class="{{patientlist.table_id}}-tab-rowcount"></span> </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <ul class="nav nav-tabs hidden-xs">
                        {% for patientlist in patientlists %}
                            <li {% if patientlist.table_id == cares_patlist_module_table %}class="active"{% endif %}>
                                <a data-toggle="tab" href="#{{patientlist.table_id}}"
                                   data-target="#{{patientlist.table_id}}, #{{patientlist.table_id}}_description"
                                >{{patientlist.title|safe}}<span class="{{patientlist.table_id}}-tab-rowcount"></span></a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% else %}
            <div class="widget-toolbar no-border">
                <strong>{% trans 'No patient lists available' %}</strong>
            </div>
            {% endif %}
        </div> {% endcomment %}
        
  <div class="widget-box {{module_name}}">
        <div class="widget-header widget-header-flat">
            <h4 class="widget-title lighter">
                <i class="ace-icon fa fa-table"></i>
                {% trans 'Tables' %}
            </h4>        
            <div class="widget-toolbar">        
                <a class="orange2" data-action="fullscreen" href="#">
                    <i class="ace-icon fa fa-expand bigger-125"></i>
                </a>        
                <a data-action="collapse" href="#">
                    <i class="1 ace-icon fa fa-chevron-up bigger-125"></i>
                </a>            
            </div>                 
        </div><!--  /widget-header -->

        
        <div class="widget-body">
        
        <div class="widget-toolbox">
            {% if can_register_patients %}
            <div style="padding:2px">
                  <a href="/m/u/wizards/register/">
                      <button class="btn btn-success">{{register_new_subject}}</button>
                    </a>
                 </div> 
            {% endif %}
        </div>
        
        <div class="widget-toolbox">
        <div class=" padding-2">
{% for patientlist in patientlists %}
{% if patientlist.description %}
            <div id="{{patientlist.table_id}}_description" class="">      
                      {{patientlist.description}}
            </div>
{% endif %}
{% endfor %}
        </div>
        </div> <!-- /widget-toolbox -->

            <div class="widget-main padding-2">
                <div class="">              
                    {% for patientlist in patientlists %}
                    <div id="{{patientlist.table_id}}" class=" ">                        
                        {{patientlist.render}}
                        <!-- legend start -->
                        {% try_to_include "modules/includes/"|add:patientlist.class_name|add:"_footer.html" %}
                        <!-- legend end -->
                    </div>
                    {%  endfor%}
                </div>
            </div>
        </div>
    </div>

{% defer_html %}
<script type="text/javascript">
$(function() {
    $('.patientlist a[data-toggle="tab"]').on('shown.bs.tab', function (e) {  
         var table_id = $(e.target).attr("href").replace("#", "");
         Cookies.set("cares_patlist_module_table", table_id, {path: '/m', {% if request.is_secure %} secure : true {% endif %}} ); 
    })
    {% for patientlist in patientlists %}
    $("#grid_{{patientlist.table_id}}").on("loaded.rs.jquery.bootgrid", function (e)
        {   
            var table$ = $(this);
            $(".{{patientlist.table_id}}-tab-rowcount").each(function() {
                $(this).html(" (" + table$.bootgrid("getTotalRowCount") + ")" )
            })
        })
    {% endfor %}
})
</script>
{% end_defer_html %}


